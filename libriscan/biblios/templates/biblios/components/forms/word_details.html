<!-- Word Details Component -->
<div id="clickedWordsContainer" class="mt-8 hidden">
  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <h3 class="card-title">Word Details</h3>
      <div class="stats stats-vertical lg:stats-horizontal shadow">
        <div class="stat">
          <div class="stat-title">Word</div>
          <div id="clickedWord" class="stat-value text-2xl"></div>
          <div class="stat-desc" id="wordMetadata"></div>
        </div>
        <div class="stat">
          <div class="stat-title">Confidence Score</div>
          <div id="confidenceScore" class="stat-value text-2xl"></div>
          <div class="stat-desc">
            <progress id="confidenceBar" class="progress w-56" value="0" max="100"></progress>
          </div>
        </div>
      </div>
      <div class="stats stats-vertical lg:stats-horizontal shadow">
        <div class="stat">
          <div class="stat-title">Position</div>
          <div id="wordPosition" class="stat-value text-lg"></div>
          <div class="stat-desc" id="wordGeometry"></div>
        </div>
      </div>
      <div class="stats stats-vertical lg:stats-horizontal shadow">
        <div class="stat">
          <div class="stat-title mb-2">Suggestions</div>
          <div id="wordSuggestions" class="stat-desc p-0">
            <!-- Suggestions will be populated here -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function getProgressClass(confidence) {
  if (confidence < 50) return 'progress progress-error';
  if (confidence < 80) return 'progress progress-warning';
  if (confidence >= 90) return 'progress progress-success';
  return 'progress';
}

function updateWordDetails(wordInfo) {
  const container = document.getElementById('clickedWordsContainer');
  const wordElement = document.getElementById('clickedWord');
  const scoreElement = document.getElementById('confidenceScore');
  const progressBar = document.getElementById('confidenceBar');
  const wordMetadata = document.getElementById('wordMetadata');
  const wordPosition = document.getElementById('wordPosition');
  const wordGeometry = document.getElementById('wordGeometry');
  
  // Show container and update basic word info
  container.classList.remove('hidden');
  wordElement.textContent = wordInfo.word;
  
  // Update confidence score and progress bar
  const confidenceValue = parseFloat(wordInfo.confidence).toFixed(3);
  scoreElement.textContent = `${confidenceValue}%`;
  progressBar.value = confidenceValue;
  progressBar.className = getProgressClass(confidenceValue);
  
  // Update metadata
  wordMetadata.textContent = `Type: ${wordInfo.text_type === 'H' ? 'Handwriting' : 'Printed'} | Control: ${wordInfo.print_control}`;
  
  // Update position information
  wordPosition.textContent = `Line ${wordInfo.line}, Word ${wordInfo.number}`;
  const formatXY = (value) => value.toFixed(4);
  const { x0, x1, y0, y1 } = wordInfo.geometry;
  wordGeometry.textContent = `X: ${formatXY(x0)} - ${formatXY(x1)} | Y: ${formatXY(y0)} - ${formatXY(y1)}`;

  // Update suggestions
  const suggestionsContainer = document.getElementById('wordSuggestions');
  suggestionsContainer.innerHTML = ''; // Clear existing suggestions
  
  if (wordInfo.suggestions && Object.entries(wordInfo.suggestions).length > 0) {
    const suggestionsList = document.createElement('ul');
    suggestionsList.className = 'menu menu-sm bg-base-200 w-full rounded-lg';
    
    Object.entries(wordInfo.suggestions).forEach(([suggestion, frequency]) => {
      const item = document.createElement('li');
      const link = document.createElement('a');
      link.className = 'flex justify-between items-center';
      link.innerHTML = `
        <span>${suggestion}</span>
        <span class="badge badge-neutral">${frequency}</span>
      `;
      link.addEventListener('click', (e) => {
        e.preventDefault();
        wordInfo.text = suggestion;
        wordElement.textContent = suggestion;
        // Remove active state from other items
        suggestionsList.querySelectorAll('a').forEach(a => a.classList.remove('active'));
        // Add active state to clicked item
        link.classList.add('active');
      });
      item.appendChild(link);
      suggestionsList.appendChild(item);
    });
    
    suggestionsContainer.appendChild(suggestionsList);
  } else {
    suggestionsContainer.textContent = 'No suggestions available';
  }
}

// Listen for word selection events
document.addEventListener('wordSelected', event => {
  updateWordDetails(event.detail);
});
</script>
