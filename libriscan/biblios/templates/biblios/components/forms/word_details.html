<!-- Word Details Component -->
<div id="clickedWordsContainer" class="mt-8 hidden">
  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <h3 class="card-title">Word Details</h3>
      <div class="stats stats-vertical lg:stats-horizontal shadow">
        <div class="stat">
          <div class="stat-title">Word</div>
          <div class="flex items-center gap-2">
            <div id="clickedWord" class="stat-value text-2xl"></div>
            <input type="text" id="wordInput" class="input input-bordered w-full max-w-xs hidden" />
            <button id="editButton" class="btn btn-ghost btn-sm">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
                <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
              </svg>
            </button>
            <button id="saveButton" class="btn btn-ghost btn-sm hidden">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
              </svg>
            </button>
            <button id="revertButton" class="btn btn-ghost btn-sm hidden">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3" />
              </svg>
            </button>
          </div>
          <div class="stat-desc" id="wordMetadata"></div>
        </div>
        <div class="stat">
          <div class="stat-title">Confidence Score</div>
          <div id="confidenceScore" class="stat-value text-2xl"></div>
          <div class="stat-desc">
            <progress id="confidenceBar" class="progress w-56" value="0" max="100"></progress>
          </div>
        </div>
      </div>
      <!-- <div class="stats stats-vertical lg:stats-horizontal shadow">
        <div class="stat">
          <div class="stat-title">Position</div>
          <div id="wordPosition" class="stat-value text-lg"></div>
          <div class="stat-desc" id="wordGeometry"></div>
        </div>
      </div> -->
      <div class="stats stats-vertical lg:stats-horizontal shadow">
        <div class="stat">
          <div class="stat-title mb-2">Suggestions</div>
          <div id="wordSuggestions" class="stat-desc p-0">
            <!-- Suggestions will be populated here -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function getProgressClass(confidence) {
  if (confidence < 50) return 'progress progress-error';
  if (confidence < 80) return 'progress progress-warning';
  if (confidence >= 90) return 'progress progress-success';
  return 'progress';
}

function updateWordDetails(wordInfo) {
  const container = document.getElementById('clickedWordsContainer');
  const wordElement = document.getElementById('clickedWord');
  const wordInput = document.getElementById('wordInput');
  const editButton = document.getElementById('editButton');
  const saveButton = document.getElementById('saveButton');
  const revertButton = document.getElementById('revertButton');
  
  // Store the original word
  const originalWord = wordInfo.word;
  const scoreElement = document.getElementById('confidenceScore');
  const progressBar = document.getElementById('confidenceBar');
  const wordMetadata = document.getElementById('wordMetadata');

  // Initialize edit functionality
  editButton.onclick = () => {
    wordElement.classList.add('hidden');
    wordInput.classList.remove('hidden');
    editButton.classList.add('hidden');
    saveButton.classList.remove('hidden');
    revertButton.classList.remove('hidden');
    wordInput.value = wordElement.textContent;
    wordInput.focus();
  };

  saveButton.onclick = () => {
    const newText = wordInput.value.trim();
    if (newText) {
      wordElement.textContent = newText;
      wordInfo.word = newText;
    }
    wordElement.classList.remove('hidden');
    wordInput.classList.add('hidden');
    editButton.classList.remove('hidden');
    saveButton.classList.add('hidden');
    revertButton.classList.add('hidden');
  };

  // Handle Enter key in input
  wordInput.onkeypress = (e) => {
    if (e.key === 'Enter') {
      saveButton.click();
    }
  };

  // Revert button functionality
  revertButton.onclick = () => {
    wordElement.textContent = originalWord;
    wordInfo.word = originalWord;
    wordElement.classList.remove('hidden');
    wordInput.classList.add('hidden');
    editButton.classList.remove('hidden');
    saveButton.classList.add('hidden');
    revertButton.classList.add('hidden');
  };
  // const wordPosition = document.getElementById('wordPosition');
  const wordGeometry = document.getElementById('wordGeometry');
  
  // Show container and update basic word info
  container.classList.remove('hidden');
  wordElement.textContent = wordInfo.word;
  
  // Update confidence score and progress bar
  const confidenceValue = parseFloat(wordInfo.confidence).toFixed(3);
  scoreElement.textContent = `${confidenceValue}%`;
  progressBar.value = confidenceValue;
  progressBar.className = getProgressClass(confidenceValue);
  
  // Update metadata
  wordMetadata.textContent = `Type: ${wordInfo.text_type === 'H' ? 'Handwriting' : 'Printed'} | Control: ${wordInfo.print_control}`;
  
  // Update position information
  // wordPosition.textContent = `Line ${wordInfo.line}, Word ${wordInfo.number}`;
  // const formatXY = (value) => value.toFixed(4);
  // const { x0, x1, y0, y1 } = wordInfo.geometry;
  // wordGeometry.textContent = `X: ${formatXY(x0)} - ${formatXY(x1)} | Y: ${formatXY(y0)} - ${formatXY(y1)}`;

  // Update suggestions
  const suggestionsContainer = document.getElementById('wordSuggestions');
  suggestionsContainer.innerHTML = ''; // Clear existing suggestions
  
  if (wordInfo.suggestions && Object.entries(wordInfo.suggestions).length > 0) {
    const suggestionsList = document.createElement('ul');
    suggestionsList.className = 'menu menu-sm bg-base-200 w-full rounded-lg';
    
    Object.entries(wordInfo.suggestions).forEach(([suggestion, frequency]) => {
      const item = document.createElement('li');
      const link = document.createElement('a');
      link.className = 'flex justify-between items-center';
      link.innerHTML = `
        <span>${suggestion}</span>
        <span class="badge badge-neutral">${frequency}</span>
      `;
      link.addEventListener('click', (e) => {
        e.preventDefault();
        wordInfo.text = suggestion;
        wordElement.textContent = suggestion;
        // Remove active state from other items
        suggestionsList.querySelectorAll('a').forEach(a => a.classList.remove('active'));
        // Add active state to clicked item
        link.classList.add('active');
      });
      item.appendChild(link);
      suggestionsList.appendChild(item);
    });
    
    suggestionsContainer.appendChild(suggestionsList);
  } else {
    suggestionsContainer.textContent = 'No suggestions available';
  }
}

// Listen for word selection events
document.addEventListener('wordSelected', event => {
  updateWordDetails(event.detail);
});
</script>
