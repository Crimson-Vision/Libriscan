{% extends "biblios/base.html" %}
{% load static %}
{% load icon_tags %}
{% load permissions %}

{% block tutorial_section %}
<!-- Tutorials Section - Only on Collection View -->
<li class="menu-title">
  <span class="flex items-center gap-2">
    {% icon 'academic-cap' css_class='size-4' %}
    Tutorials
  </span>
</li>
<li>
  <a id="startCollectionTutorial" class="active">
    {% icon 'play' css_class='size-5' %}
    <div class="flex flex-col items-start">
      <span class="font-semibold">Collection Walkthrough</span>
      <span class="text-xs opacity-70">Learn the basics</span>
    </div>
  </a>
</li>
{% endblock %}

{% block tutorial_divider %}
<div class="divider my-1"></div>
{% endblock %}

{% block title %}{{ collection }} · {{ collection.owner.short_name }} · Libriscan{% endblock %}

{% block content %}
  <!-- Breadcrumb Navigation with Icons -->
  <nav id="collection-breadcrumb" class="mb-3 text-sm breadcrumbs">
    <ul>
      <li>
        <a id="breadcrumb-organization-link" href="{{ collection.owner.get_absolute_url }}"
           class="flex items-center gap-1 hover:underline text-primary">
          <span class="inline-flex items-center justify-center size-5 rounded bg-primary/10">
            {% icon 'building-library' css_class='size-4 text-primary' %}
          </span>
          {{ collection.owner }}
        </a>
      </li>
      <li>
        <a id="breadcrumb-collection-link" href="{{ collection.get_absolute_url }}"
           class="flex items-center gap-1 hover:underline text-primary">
          <span class="inline-flex items-center justify-center size-5 rounded bg-accent/10">
            {% icon 'bars' css_class='size-4 text-accent' stroke_width='2' %}
          </span>
          {{ collection }}
        </a>
      </li>
    </ul>
  </nav>
  <div id="collection-header-card" class="card bg-base-100 shadow mb-6">
    <div id="collection-header-card-body" class="card-body">
      <div id="collection-header-actions" class="flex items-center justify-between mb-4">
        <h2 id="collection-title" class="card-title text-xl font-bold flex items-center gap-2">
          <span class="inline-flex items-center justify-center size-8 rounded-full bg-accent/10">
            {% icon 'bars' css_class='size-5 text-accent' stroke_width='2' %}
          </span>
          {{ collection }}
          {% if request.user|can_edit_org:collection.owner %}
          <a 
            href="{% url 'collection_update' collection.owner.short_name collection.slug %}"
            id="collectionEditBtn"
            class="btn btn-ghost btn-sm btn-square tooltip tooltip-right"
            data-tip="Edit collection">
            {% icon 'edit' css_class='size-4' %}
          </a>
          {% endif %}
        </h2>
        {% if request.user|can_admin_org:collection.owner %}
        <button 
          type="button" 
          id="collectionDeleteBtn"
          class="btn btn-ghost btn-sm btn-error tooltip tooltip-left"
          data-tip="Delete collection"
          onclick="showDeleteCollectionModal('{{ collection }}', '{% url 'collection_delete' collection.owner.short_name collection.slug %}')">
          {% icon 'trash' css_class='size-4' %}
        </button>
        {% endif %}
      </div>
      <!-- Series Section -->
      <div class="mb-4" id="collectionSeriesSection">
        <h3 id="series-section-title" class="text-base font-semibold text-base-content/80 mb-3">Series in this collection:</h3>
        <div class="space-y-2" id="collectionSeriesList">
          {% for series in collection.series_set.all %}
            <div id="series-card-{{ series.slug }}" class="card card-bordered bg-base-100 shadow-sm hover:shadow-md hover:border-primary/50 transition-all duration-200 group outline outline-1 outline-base-300 hover:outline-primary/50">
              <div class="card-body p-4">
                <div class="flex items-center justify-between">
                  <a id="series-link-{{ series.slug }}" href="{{ series.get_absolute_url }}" class="flex items-center gap-3 flex-1 group/link">
                    <span class="inline-flex items-center justify-center size-10 rounded-lg bg-secondary/10 group-hover/link:bg-secondary/20 transition-colors">
                      {% icon 'folder' css_class='size-5 text-secondary' stroke_width='2' %}
                    </span>
                    <span class="text-base font-semibold text-base-content group-hover/link:text-primary transition-colors">{{ series }}</span>
                  </a>
                  {% if request.user|can_edit_org:collection.owner %}
                  <button 
                    id="series-delete-btn-{{ series.slug }}"
                    type="button" 
                    class="btn btn-ghost btn-sm btn-error opacity-70 hover:opacity-100 tooltip tooltip-left"
                    data-tip="Delete series"
                    onclick="event.stopPropagation(); showDeleteSeriesModal('{{ series }}', '{% url 'series_delete' collection.owner.short_name collection.slug series.slug %}')">
                    {% icon 'trash' css_class='size-4' %}
                  </button>
                  {% endif %}
                </div>
              </div>
            </div>
          {% empty %}
            <div id="series-empty" class="card bg-base-100 border border-base-300">
              <div class="card-body p-6 text-center">
                <p class="text-sm text-base-content/60">No series in this collection yet.</p>
              </div>
            </div>
          {% endfor %}
        </div>
        {% if request.user|can_admin_org:collection.owner %}
        <div id="series-actions" class="mt-4 flex justify-end">
          <a href="{% url 'series_create' collection.owner.short_name collection.slug %}"
             id="collectionAddSeriesBtn"
             class="btn btn-primary btn-md">
            {% icon 'plus' css_class='size-5' %}
            Add New Series
          </a>
        </div>
        {% endif %}
      </div>
      <!-- Documents Section -->
      <div class="mb-4" id="collectionDocumentsSection">
        <h3 id="documents-section-title" class="text-base font-semibold text-base-content/80 mb-3">Documents in this collection:</h3>
        <div class="space-y-2" id="collectionDocumentsList">
          {% for doc in documents %}
            <div id="document-card-{{ doc.identifier }}" class="card card-bordered bg-base-100 shadow-sm hover:shadow-md hover:border-primary/50 transition-all duration-200 group outline outline-1 outline-base-300 hover:outline-primary/50">
              <div class="card-body p-4">
                <div class="flex items-center justify-between">
                  <a id="document-link-{{ doc.identifier }}" href="{{ doc.get_absolute_url }}" class="flex items-center gap-3 flex-1 group/link">
                    <span class="inline-flex items-center justify-center size-10 rounded-lg bg-warning/20 group-hover/link:bg-warning/30 transition-colors">
                      {% icon 'book' css_class='size-5' %}
                    </span>
                    <div class="flex items-center gap-2 flex-1 min-w-0">
                      <span class="text-base font-semibold text-base-content group-hover/link:text-primary transition-colors">{{ doc }}</span>
                      {% include "biblios/components/status/document_status_badge.html" with document=doc %}
                    </div>
                  </a>
                  {% if request.user|can_edit_org:collection.owner %}
                  <button 
                    id="document-delete-btn-{{ doc.identifier }}"
                    type="button" 
                    class="btn btn-ghost btn-sm btn-error opacity-70 hover:opacity-100 tooltip tooltip-left"
                    data-tip="Delete document"
                    onclick="event.stopPropagation(); showDeleteDocumentModal('{{ doc.identifier }}', '{% url 'document_delete' collection.owner.short_name collection.slug doc.identifier %}')">
                    {% icon 'trash' css_class='size-4' %}
                  </button>
                  {% endif %}
                </div>
              </div>
            </div>
          {% empty %}
            <div id="documents-empty" class="card bg-base-100 border border-base-300">
              <div class="card-body p-6 text-center">
                <p class="text-sm text-base-content/60">No documents in this collection yet.</p>
              </div>
            </div>
          {% endfor %}
        </div>
        {% if request.user|can_edit_org:collection.owner %}
        <div id="documents-actions" class="mt-4 flex justify-end">
          <a href="{% url 'document_create' collection.owner.short_name collection.slug %}"
             id="collectionAddDocumentBtn"
             class="btn btn-secondary btn-md">
            {% icon 'document' css_class='size-5' %}
            Add New Document
          </a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Delete Collection Confirmation Modal -->
  {% include "biblios/components/delete_collection_modal.html" %}
  
  <!-- Delete Series Confirmation Modal -->
  {% include "biblios/components/delete_series_modal.html" %}
  
  <!-- Delete Document Confirmation Modal -->
  {% include "biblios/components/delete_document_modal.html" %}
{% endblock content %}
