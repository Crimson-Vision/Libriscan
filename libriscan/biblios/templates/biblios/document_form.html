{% extends "biblios/base.html" %}
{% load static %}

{% block tutorial_section %}
<!-- Tutorials Section - Only on Document Form View -->
<li class="menu-title">
  <span class="flex items-center gap-2">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
      <path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.62 48.62 0 0 1 12 20.904a48.62 48.62 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.636 50.636 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.903 59.903 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.717 50.717 0 0 1 12 13.489a50.702 50.702 0 0 1 7.74-3.342M6.75 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm0 0v-3.675A55.378 55.378 0 0 1 12 8.443m-7.007 11.55A5.981 5.981 0 0 0 6.75 15.75v-1.5" />
    </svg>
    Tutorials
  </span>
</li>
<li>
  <a id="startDocumentFormTutorial" class="active">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z" />
    </svg>
    <div class="flex flex-col items-start">
      <span class="font-semibold">Document Form Guide</span>
      <span class="text-xs opacity-70">Learn the basics</span>
    </div>
  </a>
</li>
{% endblock %}

{% block tutorial_divider %}
<div class="divider my-1"></div>
{% endblock %}

{% block title %}Create New Document · {{ collection }} · Libriscan{% endblock %}

{% block content %}
    {% if object %}
        <nav class="mb-3 text-sm breadcrumbs">
            <ul>
                <li><a href="{{ object.collection.owner.get_absolute_url }}" class="text-primary hover:underline">{{ object.collection.owner }}</a></li>
                <li><a href="{{ object.collection.get_absolute_url }}" class="text-primary hover:underline">{{ object.collection }}</a></li>
                <li><span class="text-base-content/60">Edit {{ object }}</span></li>
            </ul>
        </nav>
    {% elif collection %}
        <nav class="mb-3 text-sm breadcrumbs">
            <ul>
                <li><a href="{{ collection.owner.get_absolute_url }}" class="text-primary hover:underline">{{ collection.owner }}</a></li>
                <li><a href="{{ collection.get_absolute_url }}" class="text-primary hover:underline">{{ collection }}</a></li>
                <li><span class="text-base-content/60">New Document</span></li>
            </ul>
        </nav>
    {% endif %}

    <div class="card bg-base-100 shadow max-w-2xl mx-auto" id="documentFormCard">
        <div class="card-body">
            <h2 class="card-title text-xl font-bold mb-4" id="documentFormTitle">{% if object %}Edit Document{% else %}Create Document{% endif %}</h2>
            <form method="post" class="space-y-4" id="documentForm">
                {% csrf_token %}
                {% if not object %}
                    {# Collection is determined by URL, hide it but include as hidden input #}
                    {% if form.collection %}
                        <input type="hidden" name="{{ form.collection.html_name }}" value="{{ form.collection.value }}">
                    {% endif %}
                {% else %}
                    {% if form.collection %}{{ form.collection }}{% endif %}
                {% endif %}
                <div class="form-control" id="documentIdentifierField">
                    <label for="{{ form.identifier.id_for_label }}" class="label">
                        <span class="label-text font-semibold">Identifier{% if object %} (Title){% endif %}</span>
                    </label>
                    <input type="text" name="{{ form.identifier.html_name }}" id="{{ form.identifier.id_for_label }}"
                           class="input input-bordered w-full" value="{{ form.identifier.value|default_if_none:'' }}"
                           maxlength="25" {% if object %}required{% endif %}
                           onkeyup="this.value = this.value.replace(/\s+/g, '-').replace(/[^a-zA-Z0-9-]/g, '')">
                    <label class="label">
                        <span class="label-text-alt">URL-friendly identifier (letters, numbers, and hyphens only)</span>
                    </label>
                    {% for error in form.identifier.errors %}
                        <div class="alert alert-error mt-2"><span>{{ error }}</span></div>
                    {% endfor %}
                </div>
                <div class="form-control" id="documentSeriesField">
                    <label for="{{ form.series.id_for_label }}" class="label">
                        <span class="label-text font-semibold">Series</span>
                    </label>
                    <select name="{{ form.series.html_name }}" id="{{ form.series.id_for_label }}" class="select select-bordered w-full">
                        <option value="">-----</option>
                        {% for choice in form.series.field.queryset %}
                            <option value="{{ choice.pk }}" {% if form.series.value == choice.pk %}selected{% endif %}>{{ choice }}</option>
                        {% endfor %}
                    </select>
                    {% for error in form.series.errors %}
                        <div class="alert alert-error mt-2"><span>{{ error }}</span></div>
                    {% endfor %}
                </div>
                <div class="form-control" id="documentLongSField">
                    <label class="label cursor-pointer justify-start gap-2">
                        <input type="checkbox" name="{{ form.use_long_s_detection.html_name }}" id="{{ form.use_long_s_detection.id_for_label }}"
                               class="checkbox" {% if form.use_long_s_detection.value %}checked{% endif %}>
                        <span class="label-text">Use long s ⟨ſ⟩ detection</span>
                    </label>
                    {% for error in form.use_long_s_detection.errors %}
                        <div class="alert alert-error mt-2"><span>{{ error }}</span></div>
                    {% endfor %}
                </div>
                <div class="flex gap-2 justify-end" id="documentFormActions">
                    {% if object %}
                        <a href="{% url 'document' object.collection.owner.short_name object.collection.slug object.identifier %}" id="documentFormCancelBtn" class="btn btn-ghost">Cancel</a>
                    {% else %}
                        <a href="{{ collection.get_absolute_url }}" id="documentFormCancelBtn" class="btn btn-ghost">Cancel</a>
                    {% endif %}
                    <button type="submit" id="documentFormSubmitBtn" class="btn btn-primary">{% if object %}Save Changes{% else %}Submit{% endif %}</button>
                </div>
            </form>
        </div>
    </div>
{% endblock content %}
